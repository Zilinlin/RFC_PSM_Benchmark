{
  "states": [
    "AUTHORIZATION",
    "TRANSACTION",
    "UPDATE"
  ],
  "initial_state": "AUTHORIZATION",
  "final_states": [
    "AUTHORIZATION",
    "UPDATE"
  ],
  "transitions": [
    {
      "from": "AUTHORIZATION",
      "requisite": "Client identifies itself successfully",
      "to": "TRANSACTION",
      "actions": [
        "Server acquires resources associated with the client's maildrop"
      ],
      "response": "+OK"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "Successful authentication (USER/PASS or APOP or other)",
      "to": "TRANSACTION",
      "actions": [
        "Acquire exclusive-access lock on maildrop",
        "Assign message numbers and sizes"
      ],
      "response": "+OK"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "Unsuccessful authentication or maildrop cannot be opened",
      "to": "AUTHORIZATION",
      "actions": [
        "Release lock (if acquired)",
        "Optionally close connection"
      ],
      "response": "-ERR"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "QUIT command",
      "to": null,
      "actions": [],
      "response": "+OK"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "USER command with positive status",
      "to": "AUTHORIZATION",
      "actions": [],
      "response": "+OK"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "USER command with negative status",
      "to": "AUTHORIZATION",
      "actions": [],
      "response": "-ERR"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "PASS command after successful USER",
      "to": "TRANSACTION",
      "actions": [],
      "response": "+OK"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "PASS command after successful USER (failure)",
      "to": "AUTHORIZATION",
      "actions": [],
      "response": "-ERR"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "APOP command with correct digest",
      "to": "TRANSACTION",
      "actions": [],
      "response": "+OK"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "APOP command with incorrect digest",
      "to": "AUTHORIZATION",
      "actions": [],
      "response": "-ERR"
    },
    {
      "from": "TRANSACTION",
      "requisite": "Client issues QUIT command",
      "to": "UPDATE",
      "actions": [
        "Server releases any resources acquired during the TRANSACTION state"
      ],
      "response": "+OK"
    },
    {
      "from": "TRANSACTION",
      "requisite": "STAT",
      "to": "TRANSACTION",
      "actions": [],
      "response": "+OK nn mm"
    },
    {
      "from": "TRANSACTION",
      "requisite": "LIST [msg]",
      "to": "TRANSACTION",
      "actions": [],
      "response": "+OK scan listing follows"
    },
    {
      "from": "TRANSACTION",
      "requisite": "LIST [msg] (error)",
      "to": "TRANSACTION",
      "actions": [],
      "response": "-ERR no such message"
    },
    {
      "from": "TRANSACTION",
      "requisite": "RETR msg",
      "to": "TRANSACTION",
      "actions": [],
      "response": "+OK message follows"
    },
    {
      "from": "TRANSACTION",
      "requisite": "RETR msg (error)",
      "to": "TRANSACTION",
      "actions": [],
      "response": "-ERR no such message"
    },
    {
      "from": "TRANSACTION",
      "requisite": "DELE msg",
      "to": "TRANSACTION",
      "actions": [
        "mark message as deleted"
      ],
      "response": "+OK message deleted"
    },
    {
      "from": "TRANSACTION",
      "requisite": "DELE msg (error)",
      "to": "TRANSACTION",
      "actions": [],
      "response": "-ERR no such message"
    },
    {
      "from": "TRANSACTION",
      "requisite": "NOOP",
      "to": "TRANSACTION",
      "actions": [],
      "response": "+OK"
    },
    {
      "from": "TRANSACTION",
      "requisite": "RSET",
      "to": "TRANSACTION",
      "actions": [
        "unmark deleted messages"
      ],
      "response": "+OK"
    },
    {
      "from": "TRANSACTION",
      "requisite": "TOP command",
      "to": "TRANSACTION",
      "actions": [],
      "response": "+OK"
    },
    {
      "from": "TRANSACTION",
      "requisite": "TOP command (failure)",
      "to": "TRANSACTION",
      "actions": [],
      "response": "-ERR"
    },
    {
      "from": "TRANSACTION",
      "requisite": "UIDL command",
      "to": "TRANSACTION",
      "actions": [],
      "response": "+OK"
    },
    {
      "from": "TRANSACTION",
      "requisite": "UIDL command (failure)",
      "to": "TRANSACTION",
      "actions": [],
      "response": "-ERR"
    },
    {
      "from": "TRANSACTION",
      "requisite": "QUIT command",
      "to": "UPDATE",
      "actions": [],
      "response": "+OK dewey POP3 server signing off (maildrop empty)"
    },
    {
      "from": "UPDATE",
      "requisite": "Connection close",
      "to": "AUTHORIZATION",
      "actions": [],
      "response": "Wait for next connection"
    },
    {
      "from": "TRANSACTION",
      "requisite": "QUIT command and error during removal",
      "to": "UPDATE",
      "actions": [
        "Release exclusive-access lock",
        "Close TCP connection"
      ],
      "response": "-ERR some deleted messages not removed"
    },
    {
      "from": "Any",
      "requisite": "Unrecognized, unimplemented, or syntactically invalid command",
      "to": "Same",
      "actions": [],
      "response": "-ERR"
    },
    {
      "from": "Any",
      "requisite": "Command issued in incorrect state",
      "to": "Same",
      "actions": [],
      "response": "-ERR"
    }
  ]
}