{
  "states": [
    "Initial Connection",
    "Session Initiation",
    "Client Initiation",
    "Mail Transaction",
    "Forwarding",
    "Debugging",
    "Session Termination",
    "INITIAL",
    "DATA_RECEIVED",
    "FINAL_DELIVERY",
    "Initial Lookup",
    "MX Record Found",
    "CNAME Record Found",
    "No MX Records",
    "Error State",
    "Delivery Attempt",
    "Message Accepted",
    "Delivery Failure",
    "Notification Sent",
    "Loop Detected",
    "Message Rejected",
    "Message Delivered",
    "Initial",
    "Mail From",
    "Recipient",
    "Data",
    "Quit"
  ],
  "initial_state": "Initial Connection",
  "final_states": [
    "Session Termination",
    "FINAL_DELIVERY",
    "Error State",
    "Message Delivered",
    "Quit"
  ],
  "transitions": [
    {
      "from": "Initial Connection",
      "requisite": "Client opens connection",
      "to": "Session Initiation",
      "actions": [
        "Send greeting message"
      ],
      "response": "220 Service ready"
    },
    {
      "from": "Session Initiation",
      "requisite": "Client sends EHLO or HELO",
      "to": "Client Initiation",
      "actions": [
        "Identify client"
      ],
      "response": "250 OK"
    },
    {
      "from": "Client Initiation",
      "requisite": "Client sends MAIL command",
      "to": "Mail Transaction",
      "actions": [
        "Start mail transaction"
      ],
      "response": "250 OK"
    },
    {
      "from": "Mail Transaction",
      "requisite": "Client sends RCPT command",
      "to": "Mail Transaction",
      "actions": [
        "Add recipient"
      ],
      "response": "250 OK"
    },
    {
      "from": "Mail Transaction",
      "requisite": "Client sends DATA command",
      "to": "Mail Transaction",
      "actions": [
        "Receive mail data"
      ],
      "response": "354 Start mail input"
    },
    {
      "from": "Mail Transaction",
      "requisite": "Client sends end of mail data",
      "to": "Session Termination",
      "actions": [
        "Process mail data"
      ],
      "response": "250 OK"
    },
    {
      "from": "Session Termination",
      "requisite": "Client sends QUIT command",
      "to": "Initial Connection",
      "actions": [
        "Close connection"
      ],
      "response": "221 Service closing transmission channel"
    },
    {
      "from": "INITIAL",
      "requisite": "EHLO or HELO command received",
      "to": "MAIL_TRANSACTION",
      "actions": [
        "clear buffers",
        "initialize transaction"
      ],
      "response": "250 OK"
    },
    {
      "from": "MAIL_TRANSACTION",
      "requisite": "MAIL command received",
      "to": "MAIL_TRANSACTION",
      "actions": [
        "clear forward-path buffer",
        "insert reverse-path"
      ],
      "response": "250 OK"
    },
    {
      "from": "MAIL_TRANSACTION",
      "requisite": "RCPT command received",
      "to": "MAIL_TRANSACTION",
      "actions": [
        "append forward-path"
      ],
      "response": "250 OK"
    },
    {
      "from": "MAIL_TRANSACTION",
      "requisite": "DATA command received",
      "to": "DATA_RECEIVED",
      "actions": [
        "start receiving mail data"
      ],
      "response": "354 Start mail input; end with <CRLF>.<CRLF>"
    },
    {
      "from": "DATA_RECEIVED",
      "requisite": "End of mail data indication received",
      "to": "FINAL_DELIVERY",
      "actions": [
        "process mail data",
        "clear buffers"
      ],
      "response": "250 OK"
    },
    {
      "from": "MAIL_TRANSACTION",
      "requisite": "RSET command received",
      "to": "INITIAL",
      "actions": [
        "clear all buffers"
      ],
      "response": "250 OK"
    },
    {
      "from": "MAIL_TRANSACTION",
      "requisite": "QUIT command received",
      "to": "INITIAL",
      "actions": [
        "close connection"
      ],
      "response": "221 OK"
    },
    {
      "from": "Initial Lookup",
      "requisite": "DNS lookup performed",
      "to": "MX Record Found",
      "actions": [
        "Check for MX records"
      ],
      "response": "Proceed to check MX records"
    },
    {
      "from": "Initial Lookup",
      "requisite": "CNAME record found",
      "to": "CNAME Record Found",
      "actions": [
        "Process CNAME as initial name"
      ],
      "response": "Retry lookup with CNAME"
    },
    {
      "from": "MX Record Found",
      "requisite": "MX records usable",
      "to": "Delivery Attempt",
      "actions": [
        "Sort MX records",
        "Attempt delivery"
      ],
      "response": "Delivery attempt initiated"
    },
    {
      "from": "MX Record Found",
      "requisite": "No usable MX records",
      "to": "Error State",
      "actions": [
        "Report error"
      ],
      "response": "Error reported: No usable MX records"
    },
    {
      "from": "CNAME Record Found",
      "requisite": "MX records found",
      "to": "Delivery Attempt",
      "actions": [
        "Sort MX records",
        "Attempt delivery"
      ],
      "response": "Delivery attempt initiated"
    },
    {
      "from": "CNAME Record Found",
      "requisite": "No MX records",
      "to": "Error State",
      "actions": [
        "Report error"
      ],
      "response": "Error reported: No MX records"
    },
    {
      "from": "Error State",
      "requisite": "Temporary error returned",
      "to": "Initial Lookup",
      "actions": [
        "Queue message",
        "Retry later"
      ],
      "response": "Message queued for retry"
    },
    {
      "from": "Message Accepted",
      "requisite": "Delivery Failure Occurs",
      "to": "Delivery Failure",
      "actions": [
        "Formulate Notification"
      ],
      "response": "Notification Required"
    },
    {
      "from": "Delivery Failure",
      "requisite": "Valid Return Path",
      "to": "Notification Sent",
      "actions": [
        "Send Notification"
      ],
      "response": "Notification Sent"
    },
    {
      "from": "Delivery Failure",
      "requisite": "Null Return Path",
      "to": "Message Delivered",
      "actions": [
        "Log Event"
      ],
      "response": "No Notification Sent"
    },
    {
      "from": "Message Accepted",
      "requisite": "Loop Detected",
      "to": "Loop Detected",
      "actions": [
        "Stop Processing"
      ],
      "response": "Loop Handling Initiated"
    },
    {
      "from": "Message Accepted",
      "requisite": "Hostile Content Detected",
      "to": "Message Rejected",
      "actions": [
        "Reject Message"
      ],
      "response": "Message Rejected"
    },
    {
      "from": "Message Accepted",
      "requisite": "Valid Message",
      "to": "Message Delivered",
      "actions": [
        "Deliver Message"
      ],
      "response": "Message Delivered"
    },
    {
      "from": "Initial",
      "requisite": "EHLO or HELO command",
      "to": "Mail From",
      "actions": [
        "Send greeting",
        "List capabilities"
      ],
      "response": "250 OK"
    },
    {
      "from": "Mail From",
      "requisite": "MAIL FROM command",
      "to": "Recipient",
      "actions": [
        "Accept sender"
      ],
      "response": "250 OK"
    },
    {
      "from": "Recipient",
      "requisite": "RCPT TO command",
      "to": "Recipient",
      "actions": [
        "Check recipient"
      ],
      "response": "250 OK or 550 No such user here"
    },
    {
      "from": "Recipient",
      "requisite": "DATA command",
      "to": "Data",
      "actions": [
        "Prepare to receive message"
      ],
      "response": "354 Start mail input; end with <CRLF>.<CRLF>"
    },
    {
      "from": "Data",
      "requisite": "End of message",
      "to": "Quit",
      "actions": [
        "Process message"
      ],
      "response": "250 OK"
    },
    {
      "from": "Any",
      "requisite": "QUIT command",
      "to": "Quit",
      "actions": [
        "Close connection"
      ],
      "response": "221 Service closing transmission channel"
    },
    {
      "from": "Recipient",
      "requisite": "RSET command",
      "to": "Mail From",
      "actions": [
        "Reset transaction"
      ],
      "response": "250 OK"
    }
  ]
}