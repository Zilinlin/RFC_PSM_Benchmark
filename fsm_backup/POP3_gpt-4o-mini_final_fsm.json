{
  "states": [
    "AUTHORIZATION",
    "TRANSACTION",
    "UPDATE",
    "waiting for connection",
    "authenticated",
    "maildrop accessed",
    "message retrieved",
    "message deleted",
    "session ended"
  ],
  "initial_state": "waiting for connection",
  "final_states": [
    "session ended"
  ],
  "transitions": [
    {
      "from": "waiting for connection",
      "requisite": "connection opened",
      "to": "authenticated",
      "actions": [
        "send server ready message"
      ],
      "response": "+OK POP3 server ready"
    },
    {
      "from": "authenticated",
      "requisite": "APOP command received",
      "to": "maildrop accessed",
      "actions": [
        "validate user",
        "send maildrop info"
      ],
      "response": "+OK mrose's maildrop has 2 messages (320 octets)"
    },
    {
      "from": "maildrop accessed",
      "requisite": "STAT command received",
      "to": "maildrop accessed",
      "actions": [
        "send message count"
      ],
      "response": "+OK 2 320"
    },
    {
      "from": "maildrop accessed",
      "requisite": "LIST command received",
      "to": "maildrop accessed",
      "actions": [
        "send list of messages"
      ],
      "response": "+OK 2 messages (320 octets)"
    },
    {
      "from": "maildrop accessed",
      "requisite": "RETR command received for message 1",
      "to": "message retrieved",
      "actions": [
        "send message 1"
      ],
      "response": "+OK 120 octets"
    },
    {
      "from": "message retrieved",
      "requisite": "DELE command received for message 1",
      "to": "maildrop accessed",
      "actions": [
        "delete message 1"
      ],
      "response": "+OK message 1 deleted"
    },
    {
      "from": "maildrop accessed",
      "requisite": "RETR command received for message 2",
      "to": "message retrieved",
      "actions": [
        "send message 2"
      ],
      "response": "+OK 200 octets"
    },
    {
      "from": "message retrieved",
      "requisite": "DELE command received for message 2",
      "to": "maildrop accessed",
      "actions": [
        "delete message 2"
      ],
      "response": "+OK message 2 deleted"
    },
    {
      "from": "maildrop accessed",
      "requisite": "QUIT command received",
      "to": "session ended",
      "actions": [
        "send sign off message"
      ],
      "response": "+OK dewey POP3 server signing off (maildrop empty)"
    },
    {
      "from": "session ended",
      "requisite": "connection closed",
      "to": "waiting for connection",
      "actions": [
        "wait for next connection"
      ],
      "response": "<wait for next connection>"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "client identifies itself",
      "to": "TRANSACTION",
      "actions": [
        "acquire resources"
      ],
      "response": "+OK"
    },
    {
      "from": "TRANSACTION",
      "requisite": "client issues QUIT command",
      "to": "UPDATE",
      "actions": [
        "remove messages marked as deleted",
        "release lock",
        "close TCP connection"
      ],
      "response": "+OK or -ERR"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "successful authentication",
      "to": "TRANSACTION",
      "actions": [
        "acquire lock",
        "assign message numbers"
      ],
      "response": "+OK"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "failed authentication or lock acquisition",
      "to": "AUTHORIZATION",
      "actions": [
        "release lock"
      ],
      "response": "-ERR"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "QUIT command",
      "to": "CLOSED",
      "actions": [],
      "response": "+OK"
    },
    {
      "from": "TRANSACTION",
      "requisite": "STAT command issued",
      "to": "TRANSACTION",
      "actions": [
        "issue positive response with drop listing"
      ],
      "response": "+OK nn mm"
    },
    {
      "from": "TRANSACTION",
      "requisite": "LIST command issued",
      "to": "TRANSACTION",
      "actions": [
        "issue positive response with scan listing"
      ],
      "response": "+OK scan listing follows"
    },
    {
      "from": "TRANSACTION",
      "requisite": "RETR command issued",
      "to": "TRANSACTION",
      "actions": [
        "issue positive response with message"
      ],
      "response": "+OK message follows"
    },
    {
      "from": "TRANSACTION",
      "requisite": "DELE command issued",
      "to": "TRANSACTION",
      "actions": [
        "mark message as deleted"
      ],
      "response": "+OK message deleted"
    },
    {
      "from": "TRANSACTION",
      "requisite": "NOOP command issued",
      "to": "TRANSACTION",
      "actions": [
        "do nothing"
      ],
      "response": "+OK"
    },
    {
      "from": "TRANSACTION",
      "requisite": "RSET command issued",
      "to": "TRANSACTION",
      "actions": [
        "unmark deleted messages"
      ],
      "response": "+OK"
    },
    {
      "from": "TRANSACTION",
      "requisite": "QUIT command issued",
      "to": "AUTHORIZATION",
      "actions": [],
      "response": "+OK"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "USER command issued",
      "to": "AUTHORIZATION",
      "actions": [
        "validate mailbox"
      ],
      "response": "+OK name is a valid mailbox"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "USER command issued",
      "to": "AUTHORIZATION",
      "actions": [
        "validate mailbox"
      ],
      "response": "-ERR never heard of mailbox name"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "PASS command issued after USER",
      "to": "TRANSACTION",
      "actions": [
        "lock maildrop"
      ],
      "response": "+OK maildrop locked and ready"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "PASS command issued after USER",
      "to": "AUTHORIZATION",
      "actions": [],
      "response": "-ERR invalid password"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "APOP command issued",
      "to": "TRANSACTION",
      "actions": [
        "verify digest"
      ],
      "response": "+OK maildrop locked and ready"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "APOP command issued",
      "to": "AUTHORIZATION",
      "actions": [],
      "response": "-ERR permission denied"
    },
    {
      "from": "TRANSACTION",
      "requisite": "TOP command issued",
      "to": "TRANSACTION",
      "actions": [
        "retrieve message headers and body"
      ],
      "response": "+OK top of message follows"
    },
    {
      "from": "TRANSACTION",
      "requisite": "UIDL command issued",
      "to": "TRANSACTION",
      "actions": [
        "list unique-ids"
      ],
      "response": "+OK unique-id listing follows"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "unrecognized command",
      "to": "AUTHORIZATION",
      "actions": [],
      "response": "-ERR"
    },
    {
      "from": "TRANSACTION",
      "requisite": "unrecognized command",
      "to": "TRANSACTION",
      "actions": [],
      "response": "-ERR"
    }
  ]
}