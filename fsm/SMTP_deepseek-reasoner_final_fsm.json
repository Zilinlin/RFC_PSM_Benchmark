{
  "states": [
    "INIT",
    "CONNECTED",
    "REJECTED",
    "EHLO_RECEIVED",
    "MAIL_RECEIVED",
    "RCPT_RECEIVED",
    "DATA_RECEIVED",
    "Processing Data",
    "CLOSED"
  ],
  "initial_state": "INIT",
  "final_states": [
    "CLOSED"
  ],
  "transitions": [
    {
      "from": "INIT",
      "requisite": "connection",
      "to": "CONNECTED",
      "actions": [],
      "response": "220"
    },
    {
      "from": "INIT",
      "requisite": "connection",
      "to": "REJECTED",
      "actions": [],
      "response": "554"
    },
    {
      "from": "CONNECTED",
      "requisite": "EHLO/HELO",
      "to": "EHLO_RECEIVED",
      "actions": [
        "clear buffers"
      ],
      "response": "250 OK"
    },
    {
      "from": "CONNECTED",
      "requisite": "QUIT command",
      "to": "CLOSED",
      "actions": [
        "close transmission channel"
      ],
      "response": "221 Service closing"
    },
    {
      "from": "REJECTED",
      "requisite": "QUIT",
      "to": "CLOSED",
      "actions": [],
      "response": "221"
    },
    {
      "from": "EHLO_RECEIVED",
      "requisite": "MAIL",
      "to": "MAIL_RECEIVED",
      "actions": [
        "reset_state"
      ],
      "response": "250"
    },
    {
      "from": "EHLO_RECEIVED",
      "requisite": "QUIT",
      "to": "CLOSED",
      "actions": [],
      "response": "221"
    },
    {
      "from": "EHLO_RECEIVED",
      "requisite": "RSET command",
      "to": "CONNECTED",
      "actions": [
        "clear all buffers"
      ],
      "response": "250 OK"
    },
    {
      "from": "MAIL_RECEIVED",
      "requisite": "RCPT",
      "to": "RCPT_RECEIVED",
      "actions": [
        "add_recipient"
      ],
      "response": "250"
    },
    {
      "from": "MAIL_RECEIVED",
      "requisite": "QUIT",
      "to": "CLOSED",
      "actions": [],
      "response": "221"
    },
    {
      "from": "MAIL_RECEIVED",
      "requisite": "RSET command",
      "to": "CONNECTED",
      "actions": [
        "clear all buffers"
      ],
      "response": "250 OK"
    },
    {
      "from": "RCPT_RECEIVED",
      "requisite": "RCPT",
      "to": "RCPT_RECEIVED",
      "actions": [
        "add_recipient"
      ],
      "response": "250"
    },
    {
      "from": "RCPT_RECEIVED",
      "requisite": "DATA",
      "to": "DATA_RECEIVED",
      "actions": [],
      "response": "354 Start mail input"
    },
    {
      "from": "RCPT_RECEIVED",
      "requisite": "QUIT",
      "to": "CLOSED",
      "actions": [],
      "response": "221"
    },
    {
      "from": "RCPT_RECEIVED",
      "requisite": "RSET command",
      "to": "CONNECTED",
      "actions": [
        "clear all buffers"
      ],
      "response": "250 OK"
    },
    {
      "from": "DATA_RECEIVED",
      "requisite": "data_end",
      "to": "EHLO_RECEIVED",
      "actions": [
        "process_data"
      ],
      "response": "250"
    },
    {
      "from": "DATA_RECEIVED",
      "requisite": "QUIT",
      "to": "CLOSED",
      "actions": [],
      "response": "221"
    },
    {
      "from": "DATA_RECEIVED",
      "requisite": "mail data + <CRLF>.<CRLF>",
      "to": "Processing Data",
      "actions": [
        "process mail data",
        "clear buffers"
      ],
      "response": "250 OK / 4xx / 5xx"
    },
    {
      "from": "Processing Data",
      "requisite": "new transaction (MAIL/RCPT)",
      "to": "EHLO_RECEIVED",
      "actions": [],
      "response": ""
    },
    {
      "from": "Processing Data",
      "requisite": "QUIT",
      "to": "CLOSED",
      "actions": [],
      "response": ""
    }
  ]
}