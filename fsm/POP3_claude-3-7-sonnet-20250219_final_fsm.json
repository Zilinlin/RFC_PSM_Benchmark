{
  "states": [
    "AUTHORIZATION",
    "TRANSACTION",
    "UPDATE",
    "WAITING",
    "CONNECTED",
    "AUTHENTICATED",
    "TERMINATED"
  ],
  "initial_state": "WAITING",
  "final_states": [
    "TERMINATED",
    "TCP connection closed"
  ],
  "transitions": [
    {
      "from": "WAITING",
      "requisite": "Client opens connection",
      "to": "CONNECTED",
      "actions": [
        "Accept connection"
      ],
      "response": "+OK POP3 server ready <1896.697170952@dbc.mtview.ca.us>"
    },
    {
      "from": "CONNECTED",
      "requisite": "APOP command with username and digest",
      "to": "AUTHENTICATED",
      "actions": [
        "Authenticate user"
      ],
      "response": "+OK mrose's maildrop has 2 messages (320 octets)"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "USER command with valid mailbox name",
      "to": "AUTHORIZATION",
      "actions": [
        "Record username for authentication"
      ],
      "response": "+OK name is a valid mailbox"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "USER command with invalid mailbox name",
      "to": "AUTHORIZATION",
      "actions": [],
      "response": "-ERR never heard of mailbox name"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "PASS command after successful USER command with valid password",
      "to": "TRANSACTION",
      "actions": [
        "Authenticate user",
        "Lock maildrop"
      ],
      "response": "+OK maildrop locked and ready"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "PASS command after successful USER command with invalid password",
      "to": "AUTHORIZATION",
      "actions": [],
      "response": "-ERR invalid password"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "APOP command with valid digest",
      "to": "TRANSACTION",
      "actions": [
        "Authenticate user",
        "Lock maildrop"
      ],
      "response": "+OK maildrop locked and ready"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "APOP command with invalid digest",
      "to": "AUTHORIZATION",
      "actions": [],
      "response": "-ERR permission denied"
    },
    {
      "from": "AUTHORIZATION",
      "requisite": "QUIT command",
      "to": "TERMINATED",
      "actions": [
        "Close TCP connection"
      ],
      "response": "None specified"
    },
    {
      "from": "AUTHENTICATED",
      "requisite": "STAT command",
      "to": "TRANSACTION",
      "actions": [
        "Count messages and size"
      ],
      "response": "+OK 2 320"
    },
    {
      "from": "TRANSACTION",
      "requisite": "STAT command",
      "to": "TRANSACTION",
      "actions": [
        "Get mailbox status"
      ],
      "response": "+OK or -ERR"
    },
    {
      "from": "TRANSACTION",
      "requisite": "LIST command",
      "to": "TRANSACTION",
      "actions": [
        "List messages"
      ],
      "response": "+OK 2 messages (320 octets)\n1 120\n2 200\n."
    },
    {
      "from": "TRANSACTION",
      "requisite": "RETR command with message number",
      "to": "TRANSACTION",
      "actions": [
        "Retrieve message content"
      ],
      "response": "+OK 120 octets\n<the POP3 server sends message 1>\n."
    },
    {
      "from": "TRANSACTION",
      "requisite": "DELE command with message number",
      "to": "TRANSACTION",
      "actions": [
        "Mark message for deletion"
      ],
      "response": "+OK message 1 deleted"
    },
    {
      "from": "TRANSACTION",
      "requisite": "QUIT command",
      "to": "UPDATE",
      "actions": [
        "Remove deleted messages",
        "Close session"
      ],
      "response": "+OK dewey POP3 server signing off (maildrop empty)"
    },
    {
      "from": "TRANSACTION",
      "requisite": "QUIT command",
      "to": "UPDATE",
      "actions": [
        "Remove messages marked as deleted",
        "Release exclusive-access lock on maildrop",
        "Close TCP connection"
      ],
      "response": "+OK or -ERR some deleted messages not removed"
    },
    {
      "from": "UPDATE",
      "requisite": "Client closes connection",
      "to": "WAITING",
      "actions": [
        "Wait for next connection"
      ],
      "response": ""
    },
    {
      "from": "TRANSACTION",
      "requisite": "NOOP command",
      "to": "TRANSACTION",
      "actions": [
        "Server does nothing"
      ],
      "response": "+OK"
    },
    {
      "from": "TRANSACTION",
      "requisite": "RSET command",
      "to": "TRANSACTION",
      "actions": [
        "Server unmarks any messages marked as deleted"
      ],
      "response": "+OK"
    },
    {
      "from": "TRANSACTION",
      "requisite": "TOP command with valid message number and line count",
      "to": "TRANSACTION",
      "actions": [
        "Send message headers and specified number of body lines"
      ],
      "response": "+OK top of message follows"
    },
    {
      "from": "TRANSACTION",
      "requisite": "UIDL command with valid message number",
      "to": "TRANSACTION",
      "actions": [
        "Send unique-id listing for specified message"
      ],
      "response": "+OK [message-number] [unique-id]"
    },
    {
      "from": "TRANSACTION",
      "requisite": "UIDL command with no arguments",
      "to": "TRANSACTION",
      "actions": [
        "Send unique-id listing for all messages"
      ],
      "response": "+OK unique-id listing follows"
    },
    {
      "from": "TRANSACTION",
      "requisite": "UIDL command with invalid message number",
      "to": "TRANSACTION",
      "actions": [],
      "response": "-ERR no such message"
    },
    {
      "from": "TRANSACTION",
      "requisite": "LIST command (no argument)",
      "to": "TRANSACTION",
      "actions": [
        "Server lists all non-deleted messages with sizes"
      ],
      "response": "+OK scan listing follows"
    },
    {
      "from": "TRANSACTION",
      "requisite": "LIST command (with valid message number)",
      "to": "TRANSACTION",
      "actions": [
        "Server provides information for specified message"
      ],
      "response": "+OK n size"
    },
    {
      "from": "TRANSACTION",
      "requisite": "LIST command (with invalid message number)",
      "to": "TRANSACTION",
      "actions": [],
      "response": "-ERR no such message"
    },
    {
      "from": "TRANSACTION",
      "requisite": "RETR command (with valid message number)",
      "to": "TRANSACTION",
      "actions": [
        "Server sends the entire message"
      ],
      "response": "+OK message follows"
    },
    {
      "from": "TRANSACTION",
      "requisite": "RETR command (with invalid message number)",
      "to": "TRANSACTION",
      "actions": [],
      "response": "-ERR no such message"
    },
    {
      "from": "TRANSACTION",
      "requisite": "DELE command (with valid message number)",
      "to": "TRANSACTION",
      "actions": [
        "Server marks message as deleted"
      ],
      "response": "+OK message deleted"
    },
    {
      "from": "TRANSACTION",
      "requisite": "DELE command (with invalid message number)",
      "to": "TRANSACTION",
      "actions": [],
      "response": "-ERR no such message"
    },
    {
      "from": "TRANSACTION",
      "requisite": "QUIT command",
      "to": "UPDATE",
      "actions": [],
      "response": ""
    },
    {
      "from": "TRANSACTION",
      "requisite": "QUIT command",
      "to": null,
      "actions": [
        "End session"
      ],
      "response": "+OK or -ERR"
    },
    {
      "from": "TRANSACTION",
      "requisite": "Inactivity autologout timer expires (if implemented)",
      "to": "TCP connection closed",
      "actions": [
        "Server closes TCP connection without removing messages"
      ],
      "response": "None"
    },
    {
      "from": "ANY",
      "requisite": "Session terminates for reason other than client-issued QUIT",
      "to": "TERMINATED",
      "actions": [
        "Do not remove messages",
        "Close TCP connection"
      ],
      "response": "None specified"
    },
    {
      "from": "UPDATE",
      "requisite": "Server completes resource release",
      "to": "TCP connection closed",
      "actions": [
        "TCP connection is closed"
      ],
      "response": "None"
    }
  ]
}